---
description: API architecture and route organization
alwaysApply: true
---
# API Architecture - Route Organization

## Route Structure

### `/api/internal/*` - Database-First Routes (Primary)
- **Purpose**: Primary data access with intelligent caching
- **Behavior**: Check database first, fetch externally only when needed
- **Use for**: All data display, performance-critical paths

### `/api/[external]/*` - External API Proxies
- **Purpose**: Direct passthrough to external APIs
- **Behavior**: Always hits external API, no caching
- **Use for**: Real-time data requirements only

### `/api/sync/*` - Data Synchronization
- **Purpose**: Explicit sync operations
- **Examples**: `/api/sync/users`, `/api/sync/data`

## DRY Pattern for Routes

**Shared Handlers** for duplicate routes:
```typescript
// lib/api-handlers/example.ts
export async function handleExample(req, id) {
  // All logic here
}

// /api/internal/example/[id]/route.ts (PRIMARY)
export async function GET(req, { params }) {
  return handleExample(req, params.id);
}

// /api/example/[id]/route.ts (ALIAS - if needed for backward compat)
export { GET } from '@/app/api/internal/example/[id]/route';
```

## Frontend API Calls

Always use `/api/internal/*` routes for:
- Displaying data to users
- Database-backed features
- Performance-critical paths
