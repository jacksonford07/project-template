---
description: Prisma migration workflow
---
# Prisma Migration Workflow

## CRITICAL: Always Use `prisma migrate dev`

### WRONG: Using `db push`
```bash
pnpm prisma db push  # No migration file created!
```

**Problem**: Changes database without migration file. Production won't get changes.

### CORRECT: Using `prisma migrate dev`
```bash
pnpm prisma migrate dev --name descriptive_name
```

**Examples**:
```bash
pnpm prisma migrate dev --name add_user_table
pnpm prisma migrate dev --name add_deleted_at_column
pnpm prisma migrate dev --name create_junction_tables
```

## When to Use Each Command

| Command | Use For |
| --- | --- |
| `prisma migrate dev` | All schema changes (primary) |
| `prisma db push` | Quick experiments only (never commit) |
| `prisma migrate deploy` | Production (automatic via build) |

## Migration Best Practices

### 1. Descriptive Names
```bash
# Good:
pnpm prisma migrate dev --name add_subscriber_history_table

# Bad:
pnpm prisma migrate dev --name update
```

### 2. One Logical Change Per Migration
```bash
# Good:
# - Migration 1: Add User table
# - Migration 2: Add soft delete columns

# Bad:
# - Migration 1: Add 3 tables, remove 2 columns, change indexes
```

### 3. Never Edit Migration Files

Once created, migration files are **immutable**. Create new migrations to fix issues.

## Production Flow

Automatic in build script:
```json
{
  "build": "prisma generate && node scripts/migrate.js && next build"
}
```
